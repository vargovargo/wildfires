select(county, indStrt, est, dataSet) %>%
group_by(indStrt) %>%
ntile(est, 58)
CHVIdata <- readRDS("~/GitHub/CAclimateOpinion/bivar/chviCountyTidyRace.RDS") %>%
filter(race == "Total") %>%
mutate(indStrt = ifelse(strata =="none",def, paste0(def," (",strata,")")),
dataSet = "CCHVI") %>%
select(county, indStrt, est, dataSet) %>%
group_by(indStrt) %>%
ntile(58)
shiny::runApp('GitHub/wildfires/kurtWFpaper/kurtPaper')
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(totalCases = white+hispanic+black+native_am+asian_pi+other+missing)
foo
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(totalCases = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high")))
foo  %>% ggplot() + geom_boxplot(aes(x = date, y =pm_25/100, group=date)) +geom_boxplot(aes(x=date, y=totalCases, group=date),  color="blue")
foo  %>% ggplot() + geom_boxplot(aes(x = date, y =pm_25/100, group=date)) +geom_boxplot(aes(x=date, y=totalCases, group=date),  shape= 3, color="blue")
shiny::runApp('GitHub/wildfires/kurtWFpaper/kurtPaper')
library(tidyverse)
library(DT)
library(foreign)
foo <- read.dta("~/Tamu_urbanRural/CHIS/ADULT.dta")
View(foo)
names(foo)
unique(foo$ur_tract)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
filter(race == raceSelection)
rm(list = ls())
library(tidyverse)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(totalCases = white+hispanic+black+native_am+asian_pi+other+missing)
raceSelection <- "white"
lowMed <- 12
medHi <- 35
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
filter(race == raceSelection)
View(foo)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
filter(race == raceSelection) %>%
select(zip, date, race, exposure, count)
View(foo)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count))
View(gerg)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value)
View(gerg)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
View(gerg)
gerg %>% filter(metric == rate)
View(gerg)
gerg %>% filter(metric == rate) %>%
mutate(lowMedRD == med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
View(gerg)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD == med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD == med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff, color=comparison)) + geom_point()
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff, color=comparison)) + geom_point() + coord_flip()
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(. ~ comparison)
gerg <- foo %>% group_by(race, date, exposure) %>%
summarise(sum = sum(count),
zips = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, zips, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(. ~ comparison)
View(gerg)
View(gerg)
zip
gerg <- foo %>% .group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(. ~ comparison)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(. ~ comparison)
gerg <- foo %>% group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(comparison, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(. ~ comparison)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(comparison, RiskDiff), x=RiskDiff, color=comparison)) + geom_point()
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)
gerg <- foo %>% group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(comparison, RiskDiff, color= race), x=RiskDiff, color=comparison)) + geom_point()
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(comparison, RiskDiff), x=RiskDiff, color=race)) + geom_point()
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color=comparison)) + geom_point() + facet_grid(.~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, x=RiskDiff)) + geom_point() + facet_grid(.~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_point() + facet_grid(.~ race)
rm(list = ls())
library(tidyverse)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(totalCases = white+hispanic+black+native_am+asian_pi+other+missing)
raceSelection <- "white"
lowMed <- 12
medHi <- 35
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate") %>%
mutate(lowMedRD = med-low,
lowHighRD = high - low) %>%
gather(lowMedRD, lowHighRD, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_point() + facet_grid(.~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_point() + facet_grid(.~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_boxplot() + facet_grid(.~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff)) + geom_point() + facet_grid(comparison~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff, color = race)) + geom_point() + facet_grid(. ~ comparison)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff, color = race)) + geom_point() + facet_grid(race ~ comparison)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(zip, RiskDiff), y=RiskDiff, color = comparison)) + geom_point() + facet_grid(race ~ .)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(race ~ .)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race !%in% c("other","missing")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_boxplot() + facet_grid(.~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
shiny::runApp('GitHub/CHVIr/CHVIz')
rm(list = ls())
library(tidyverse)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(totalCases = white+hispanic+black+native_am+asian_pi+other+missing)
raceSelection <- "white"
lowMed <- 12
medHi <- 35
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_boxplot() + facet_grid(.~ race)
gerg <- foo %>% group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(race, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(race, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(race, RiskDiff), x=RiskDiff, color = comparison)) + geom_point()
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(race, RiskDiff), x=RiskDiff, color = comparison)) + geom_bar(stat="identity", position="dodge")
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(race, RiskDiff), y=RiskDiff, color = comparison)) + geom_bar(stat="identity", position="dodge")
gerg %>% filter(metric == "rate") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=reorder(race, RiskDiff), y=RiskDiff, fill = comparison)) + geom_bar(stat="identity", position="dodge")
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate" & race == "all") %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_boxplot() + facet_grid(.~ race)
gerg %>% filter(metric == "rate" & race == raceSelection) %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
runApp('GitHub/wildfires/kurtWFpaper/kurtPaper')
runApp('GitHub/wildfires/kurtWFpaper/kurtPaper')
read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)  %>%
group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
casesPerDay = sum(count)/length(count))
read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)  %>%
group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
casesPerDay = sum(count)/length(count)) %>%
ggplot(aes(x=reorder(race, casesPerDay), y=casesPerDay, fill = exposure)) + geom_bar(stat="identity", position="dodge")
runApp('GitHub/wildfires/kurtWFpaper/kurtPaper')
rm(list = ls())
library(tidyverse)
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing)
raceSelection <- "white"
lowMed <- 12
medHi <- 35
foo <- read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)
gerg <- foo %>% group_by(race, zip, exposure) %>%
summarise(sum = sum(count),
days = length(count),
rate = sum(count)/length(count)) %>%
gather(sum, days, rate, key = metric, value = value) %>%
spread(key = exposure, value = value)
gerg %>% filter(metric == "rate" & race == raceSelection) %>%
mutate(lowToMedRiskDiff = med - low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(y=reorder(zip, RiskDiff), x=RiskDiff, color = comparison)) + geom_point() + facet_grid(. ~ race)
gerg %>% filter(metric == "rate" & race %in% c("white","all", "hispanic","black","asian_pi")) %>%
mutate(lowToMedRiskDiff = med-low,
lowToHighRiskDiff = high - low) %>%
gather(lowToMedRiskDiff, lowToHighRiskDiff, key = comparison, value = RiskDiff) %>%
ggplot(aes(x=comparison, y=RiskDiff)) + geom_boxplot() + facet_grid(.~ race)
read.csv("~/Wildfires_kurt/PoissonTest/PoissonSandboxData.csv", stringsAsFactors = FALSE) %>%
rename(zip = bene_addr_zip,
date = svc_from_dt) %>%
transform(date = as.Date(date)) %>%
mutate(all = white+hispanic+black+native_am+asian_pi+other+missing,
exposure = factor(ifelse(pm_25<lowMed, "low", ifelse(pm_25<medHi, "med","high")), levels = c("low","med","high"))) %>%
gather(all, white,hispanic,black,native_am,asian_pi,other,missing, key = race, value = count) %>%
transform(race = factor(race, levels = c("all", "white","hispanic","black","asian_pi","native_am","other","missing"))) %>%
select(zip, date, race, exposure, count)  %>%
group_by(race, exposure) %>%
summarise(sum = sum(count),
days = length(count),
casesPerDay = sum(count)/length(count)) %>%
ggplot(aes(x=reorder(race, casesPerDay), y=casesPerDay, fill = exposure)) + geom_bar(stat="identity", position="dodge")
